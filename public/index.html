<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HOO SMART MONITOR V6.0</title>
    <!-- PWA & Mobile Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HOO SMART">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/jairokov/miweb/main/owl-logo.png">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Inter:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <style>
        :root {
            --gold-primary: #e2b053;
            --gold-secondary: #ffb347;
            --dark-bg: #0a0b0d;
            --panel-bg: rgba(255, 255, 255, 0.03);
            --border-color: rgba(226, 176, 83, 0.15);
        }
        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--dark-bg);
            color: white;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }
        .gold-gradient {
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 24px;
        }
        .gauge-background {
            fill: none;
            stroke: rgba(255, 255, 255, 0.05);
            stroke-width: 10;
        }
        .gauge-progress {
            fill: none;
            stroke: var(--gold-primary);
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-in-out, stroke 0.5s;
            filter: drop-shadow(0 0 8px rgba(226, 176, 83, 0.5));
        }
        @keyframes pulse-gold {
            0% {
                box-shadow: 0 0 0 0 rgba(226, 176, 83, 0.4);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(226, 176, 83, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(226, 176, 83, 0);
            }
        }
        .btn-pulse {
            animation: pulse-gold 2s infinite;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .danger-banner {
            background: linear-gradient(90deg, #ff4b2b, #ff416c);
            color: white;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: slideDown 0.5s ease-out;
        }
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }
            to {
                transform: translateY(0);
            }
        }
        /* Ocultar barra de scroll */
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="h-screen w-full flex flex-col">
    <!-- Splash Screen / Audio Unlock -->
    <div id="splash"
        class="fixed inset-0 z-[100] bg-[#0a0b0d] flex flex-col items-center justify-center p-8 transition-opacity duration-700">
        <div class="mb-8 w-24 h-24 rounded-full glass-panel flex items-center justify-center border-gold btn-pulse">
            <svg viewBox="0 0 100 100" class="w-14 h-14 text-[#e2b053]">
                <path d="M50 15 L80 35 L80 65 L50 85 L20 65 L20 35 Z" fill="none" stroke="currentColor"
                    stroke-width="4" />
                <circle cx="50" cy="50" r="10" fill="currentColor" />
            </svg>
        </div>
        <h1 class="text-4xl font-extrabold tracking-tighter mb-2">HOO <span class="gold-gradient">SMART</span></h1>
        <p class="text-white/40 text-xs uppercase tracking-[0.3em] font-light mb-12">V6.0 Terminal de Energía</p>
        <button onclick="unlockApp()"
            class="w-full max-w-xs py-5 bg-gradient-to-r from-[#e2b053] to-[#ffb347] text-black font-bold text-lg rounded-2xl shadow-2xl hover:scale-105 transition-transform">
            CONECTAR TERMINAL
        </button>
    </div>
    <!-- Alertas Banner -->
    <div id="banner-alerta"
        class="hidden fixed top-0 left-0 w-full z-50 p-3 danger-banner text-center text-xs shadow-xl">
        ⚠️ ATENCIÓN: MOVIMIENTO BRUSCO EN MERCADO PARALELO
    </div>
    <!-- App Header -->
    <header class="pt-12 px-8 flex justify-between items-center z-10">
        <div>
            <h2 class="text-xs text-white/40 font-bold uppercase tracking-widest leading-none mb-1">Mercado</h2>
            <div class="flex items-center gap-2">
                <span class="text-xl font-bold tracking-tight">HOO MONITOR</span>
                <span id="label-status" class="status-badge bg-green-500/20 text-green-500">CONECTADO</span>
            </div>
        </div>
        <div class="flex gap-4">
            <button onclick="fetchData()" id="refresh-btn"
                class="p-3 glass-panel text-white/60 hover:text-white transition-colors">
                <i data-lucide="refresh-cw" class="w-5 h-5"></i>
            </button>
        </div>
    </header>
    <!-- Main Content -->
    <main class="flex-1 flex flex-col items-center justify-center px-8 space-y-8 z-10 overflow-y-auto pb-24">
        <!-- Gauge Central -->
        <div class="relative flex items-center justify-center">
            <svg width="260" height="260" viewBox="0 0 160 160" class="transform -rotate-90">
                <circle class="gauge-background" cx="80" cy="80" r="70" />
                <circle id="gauge-bar" class="gauge-progress" cx="80" cy="80" r="70" stroke-dasharray="440"
                    stroke-dashoffset="440" />
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                <span id="brecha-label" class="text-5xl font-extrabold tracking-tighter leading-none mb-1">0.0%</span>
                <span class="text-[10px] uppercase font-bold text-white/40 tracking-widest">Brecha Oficial</span>
            </div>
        </div>
        <!-- Indicador Principal: USDT -->
        <div class="w-full max-w-md glass-panel p-6 relative overflow-hidden">
            <div class="flex justify-between items-start mb-1">
                <div class="flex items-center gap-2">
                    <span class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center text-green-500">
                        <i data-lucide="trending-up" class="w-4 h-4"></i>
                    </span>
                    <span class="text-sm font-semibold text-white/60">Binance P2P (Dinámico)</span>
                </div>
                <div id="mercado-trend" class="text-[10px] font-bold text-white/30 uppercase tracking-tighter">Estable
                </div>
            </div>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-extrabold font-['Inter']" id="price-usdt">0.00</span>
                <span class="text-lg font-bold text-white/40">Bs.</span>
            </div>
            <div id="variation-val" class="text-xs font-bold text-green-500 mt-1">+0.00% hoy</div>
        </div>
        <!-- Anclas Oficiales: BCV y EURO -->
        <div class="w-full max-w-md grid grid-cols-2 gap-4">
            <!-- BCV USD -->
            <div class="glass-panel p-5">
                <span class="text-[10px] font-bold text-white/40 uppercase block mb-2">BCV USD (Ancla)</span>
                <div class="flex items-baseline gap-1">
                    <span class="text-xl font-bold" id="price-bcv">0.00</span>
                    <span class="text-xs text-white/40">Bs.</span>
                </div>
            </div>
            <!-- BCV EUR -->
            <div class="glass-panel p-5 border-l-4 border-l-[#e2b053]/30">
                <span class="text-[10px] font-bold text-[#e2b053]/60 uppercase block mb-2">BCV EUR (Oficial)</span>
                <div class="flex items-baseline gap-1">
                    <span class="text-xl font-bold gold-gradient" id="price-eur">0.00</span>
                    <span class="text-xs text-white/40">Bs.</span>
                </div>
            </div>
        </div>
    </main>
    <!-- Footer Branding -->
    <footer class="p-8 text-center opacity-30 pointer-events-none">
        <p class="text-[10px] uppercase tracking-[0.4em] font-bold">Maracaibo Software Lab &copy; 2026</p>
    </footer>
    <!-- Audio Elements -->
    <audio id="alert-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"
        preload="auto"></audio>
    <script>
        let lastKnownId = null;
        let audioContext = null;
        let isUnlocked = false;
        function unlockApp() {
            document.getElementById('splash').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash').style.display = 'none';
                isUnlocked = true;
                // Desbloquear audio en móviles
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                fetchData();
                setInterval(fetchData, 30000);
            }, 700);
        }
        async function fetchData() {
            const btn = document.getElementById('refresh-btn');
            btn?.classList.add('animate-spin');
            try {
                // Cambia esta URL a tu endpoint real de Render
                const response = await fetch('/precio-actual');
                if (!response.ok) throw new Error("Offline");
                const data = await response.json();
                updateUI(data);
                // Lógica Smart: Alertas
                if (data.id !== lastKnownId) {
                    if (data.alerta_audio) triggerAudio();
                    if (data.mostrar_banner) toggleBanner(true);
                    else toggleBanner(false);
                    lastKnownId = data.id;
                }
            } catch (err) {
                console.error("Fallo de conexión:", err);
                document.getElementById('label-status').textContent = "SIN CONEXIÓN";
                document.getElementById('label-status').className = "status-badge bg-red-500/20 text-red-500";
            } finally {
                setTimeout(() => btn?.classList.remove('animate-spin'), 1000);
            }
        }
        function updateUI(data) {
            // Actualizar Precios
            document.getElementById('price-usdt').textContent = data.precio_usdt;
            document.getElementById('price-bcv').textContent = data.precio_bcv;
            document.getElementById('price-eur').textContent = data.precio_eur;
            // Variación de Mercado
            const varVal = document.getElementById('variation-val');
            varVal.textContent = (data.variacion_mercado || '0.00%') + ' hoy';
            // Status/Trend
            document.getElementById('mercado-trend').textContent = data.status || 'Estable';
            // Tacómetro (Brecha)
            const brechaStr = data.brecha_porcentaje.replace('%', '');
            const brechaVal = parseFloat(brechaStr);
            document.getElementById('brecha-label').textContent = brechaStr + '%';
            // Animación Gauge
            const dashOffset = 440 - (440 * Math.min(brechaVal, 30) / 30);
            document.getElementById('gauge-bar').style.strokeDashoffset = dashOffset;
            // Colores Dinámicos
            if (brechaVal > 20) {
                document.getElementById('gauge-bar').style.stroke = "#ff4b2b";
            } else {
                document.getElementById('gauge-bar').style.stroke = "var(--gold-primary)";
            }
        }
        function triggerAudio() {
            const audio = document.getElementById('alert-sound');
            audio.play().catch(e => console.log("Audio bloqueado por navegador"));
        }
        function toggleBanner(show) {
            const banner = document.getElementById('banner-alerta');
            if (show) banner.classList.remove('hidden');
            else banner.classList.add('hidden');
        }
        // Inicializar Lucide
        lucide.createIcons();
    </script>
</body>
</html>
