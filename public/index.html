<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HOO | Quantum Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00ffaa; --bg: #030508; }
        body { background: var(--bg); color: white; font-family: 'Rajdhani', sans-serif; overflow: hidden; }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        .neon-text { text-shadow: 0 0 10px var(--neon); color: var(--neon); }
        
        /* Estilos de Relojes */
        .gauge-ring { fill: none; stroke: rgba(255,255,255,0.03); stroke-linecap: round; }
        .gauge-value { fill: none; stroke: var(--neon); stroke-linecap: round; transition: stroke-dashoffset 2s ease-in-out; }
        .owl-easter-egg { opacity: 0.15; filter: drop-shadow(0 0 2px var(--neon)); transition: opacity 0.3s; }
        .owl-easter-egg:hover { opacity: 0.8; }
    </style>
</head>
<body class="h-screen flex flex-col justify-between py-6">

    <header class="px-8 flex justify-between items-center">
        <h1 class="text-xl font-bold tracking-[0.3em] font-['Orbitron'] opacity-60">HOO</h1>
        <div class="owl-easter-egg">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><circle cx="9" cy="9" r="0.8" fill="var(--neon)"/><circle cx="15" cy="9" r="0.8" fill="var(--neon)"/><path d="m12 11.5 1 1.5-1 1.5-1-1.5z"/>
            </svg>
        </div>
    </header>

    <main class="flex-1 flex flex-col items-center justify-center space-y-12">
        
        <div class="relative flex items-center justify-center">
            <svg width="240" height="240" viewBox="0 0 200 200">
                <circle class="gauge-ring" cx="100" cy="100" r="85" stroke-width="10" />
                <circle id="gap-arc" class="gauge-value" cx="100" cy="100" r="85" stroke-width="10" 
                        stroke-dasharray="534" stroke-dashoffset="534" transform="rotate(-90 100 100)" />
            </svg>
            
            <div class="absolute bottom-[-10px] right-[-10px]">
                <svg width="100" height="100" viewBox="0 0 100 100">
                    <circle class="gauge-ring" cx="50" cy="50" r="35" stroke-width="6" fill="#030508" />
                    <circle id="var-arc" class="gauge-value" cx="50" cy="50" r="35" stroke-width="6" 
                            stroke-dasharray="220" stroke-dashoffset="220" transform="rotate(-90 50 50)" />
                    <text x="50" y="55" text-anchor="middle" id="var-text" class="text-[10px] font-bold fill-emerald-400 font-mono">0.0%</text>
                </svg>
            </div>

            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <span id="brecha" class="text-6xl font-black font-['Orbitron'] neon-text tracking-tighter">--%</span>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-[0.2em]">Market Gap</p>
            </div>
        </div>

        <div class="w-full max-w-xs space-y-6 px-4">
            <div class="flex justify-between items-end border-b border-white/5 pb-2">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Binance P2P</p>
                <div class="flex items-baseline gap-1">
                    <span class="text-white/20 text-xs font-bold">Bs</span>
                    <h2 id="usdt" class="text-3xl font-bold font-mono tracking-tighter">--,--</h2>
                </div>
            </div>
            <div class="flex justify-between items-end border-b border-white/5 pb-2">
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Oficial BCV</p>
                <div class="flex items-baseline gap-1">
                    <span class="text-white/20 text-xs font-bold">Bs</span>
                    <h2 id="bcv" class="text-3xl font-bold font-mono tracking-tighter">--,--</h2>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center px-6">
        <p class="text-[8px] text-slate-600 uppercase tracking-[0.4em] mb-1">Automatiza tu negocio con IA</p>
        <p class="text-[10px] font-black text-white/30 tracking-[0.2em]">DESARROLLADO POR @JAIROKOV</p>
    </footer>

    <script>
        let currentId = null;
        const alertSfx = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');

        async function refreshHoo() {
            try {
                const r = await fetch('/precio-actual');
                const d = await r.json();

                // ANTIFRICCIÓN: Silencio total si el ID no ha cambiado
                if (currentId !== null && d.id === currentId) return;

                const isUpdate = currentId !== null;
                currentId = d.id;

                // Actualizar Textos
                document.getElementById('bcv').innerText = d.precio_bcv;
                document.getElementById('usdt').innerText = d.precio_usdt;
                document.getElementById('brecha').innerText = d.brecha_porcentaje;

                // Animación Reloj Grande (Gap)
                const gapVal = parseFloat(d.brecha_porcentaje.replace(',', '.'));
                const gapOffset = 534 - (534 * Math.min(gapVal, 30) / 30);
                document.getElementById('gap-arc').style.strokeDashoffset = gapOffset;

                // Animación Reloj Pequeño (Variación - Simulado para el ejemplo)
                document.getElementById('var-arc').style.strokeDashoffset = 110; // 50% del pequeño
                document.getElementById('var-text').innerText = "+2.0%";

                // Solo pitar si hay cambio real del 2% (ID nuevo)
                if (isUpdate) {
                    alertSfx.play().catch(() => {});
                    if (Notification.permission === "granted") {
                        new Notification("HOO ALERT", { body: `Cambio del 2%: ${d.brecha_porcentaje}` });
                    }
                }
            } catch (e) { console.log("Sincronizando..."); }
        }

        document.body.onclick = () => { alertSfx.play().then(() => alertSfx.pause()); Notification.requestPermission(); };
        setInterval(refreshHoo, 20000);
        refreshHoo();
    </script>
</body>
</html>
